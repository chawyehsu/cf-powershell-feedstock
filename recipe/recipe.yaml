context:
  name: powershell
  version: 7.5.2

package:
  name: ${{ name|lower }}
  version: ${{ version }}

source:
  - url: https://raw.githubusercontent.com/PowerShell/PowerShell/refs/tags/v${{ version }}/assets/additionalAttributions.txt
    sha256: cd2d609357d2eebb43ada3870b9a63eb2c155c237ca89ad6cfaa4215023a5dab
    target_directory: powershell/assets
  - if: win
    then:
      - url: https://github.com/PowerShell/PowerShell/releases/download/v${{ version }}/PowerShell-${{ version }}-win-x64.zip
        sha256: 6cdabe52dcc2830929a53a970f689ab42b3819d34274cb2fbdd92aac13f66b92
        target_directory: powershell
  - if: linux and x86_64
    then:
      - url: https://github.com/PowerShell/PowerShell/releases/download/v${{ version }}/powershell-${{ version }}-linux-x64.tar.gz
        sha256: 8fa9584f6f95d29ca1466c4397ac39c371373d6581c12dfae9ebd53c06d77664
        target_directory: powershell
  - if: linux and aarch64
    then:
      - url: https://github.com/PowerShell/PowerShell/releases/download/v${{ version }}/powershell-${{ version }}-linux-arm64.tar.gz
        sha256: d4d2c55628755f5cd8b2609ad7117c1eada0aa0086f195d48131ee482ef7d71a
        target_directory: powershell
  - if: osx and arm64
    then:
      - url: https://github.com/PowerShell/PowerShell/releases/download/v${{ version }}/powershell-${{ version }}-osx-arm64.tar.gz
        sha256: a02d1d79589c71e8d35e458d90f085cfc1f0a688ebbea4dab8632187c057f7a1
        target_directory: powershell


build:
  number: 2
  skip:
    - osx and x86_64  # Skip Intel macOS for now
  script:
    - if: win
      then: |
        xcopy powershell "%PREFIX%\powershell" /E /I /F /B /Y
        if %ERRORLEVEL% neq 0 exit 1
        echo F | xcopy %RECIPE_DIR%\pwsh.cmd %PREFIX%\Scripts\pwsh.cmd /F /Y
        if %ERRORLEVEL% neq 0 exit 1
    - if: unix
      then: |
        mkdir -p $PREFIX/powershell
        cp -r powershell/* $PREFIX/powershell/
        chmod +x $PREFIX/powershell/pwsh
        mkdir -p $PREFIX/bin
        cp $RECIPE_DIR/pwsh.sh $PREFIX/bin/pwsh
        chmod +x $PREFIX/bin/pwsh

requirements:
  run:
    - if: linux
      then:
        - icu


tests:
  - script:
      - if: win
        then:
          - where powershell
          - if not exist %PREFIX%\\powershell\\pwsh.exe exit 1
      - if: unix
        then:
          - which pwsh
          - test -x $PREFIX/powershell/pwsh
          - pwsh -Version

about:
  summary: PowerShell for every system!
  license: MIT
  license_file:
    - powershell/LICENSE.txt
    - powershell/ThirdPartyNotices.txt
    - powershell/assets/additionalAttributions.txt

  homepage: https://github.com/PowerShell/PowerShell

extra:
  recipe-maintainers:
    - dhirschfeld
